概要：为了实现可视化人力支援调配，对公司人力资源进行合理调用，特此设计此人力资源调度系统，本系统不涉及打卡考勤，薪资、绩效管理、职级晋升等常规hr系统功能，而是专注于实现在公司四个战略区域的人力资源调配。
第一章公司概况
1.1公司详情
吉盛园林，在中国拥有四个战略业务聚集地：西南区域、华中区域、华南区域、华东区域

2.1功能需求，通过拖曳的方式将员工分配至项目

2.2 API接口
- 健康检查：`GET /healthz`
- 员工：
  - 创建员工：`POST /api/v1/employees/`
  - 列出员工：`GET /api/v1/employees/`
  - 获取员工详情：`GET /api/v1/employees/{employee_id}`
  - 更新员工信息：`PUT /api/v1/employees/{employee_id}`
  - 删除员工：`DELETE /api/v1/employees/{employee_id}`
- 项目：
  - 创建项目：`POST /api/v1/projects/`
  - 列出项目：`GET /api/v1/projects/`
  - 获取项目详情：`GET /api/v1/projects/{project_id}`
  - 更新项目信息：`PUT /api/v1/projects/{project_id}`
  - 删除项目：`DELETE /api/v1/projects/{project_id}`
  - 为项目指派员工：`POST /api/v1/projects/{project_id}/assignments`
  - 获取项目成员列表：`GET /api/v1/projects/{project_id}/members`
- 区域：
  - 创建区域：`POST /api/v1/regions/`
  - 列出区域：`GET /api/v1/regions/`
  - 获取区域详情：`GET /api/v1/regions/{region_id}`
  - 更新区域信息：`PUT /api/v1/regions/{region_id}`
  - 删除区域：`DELETE /api/v1/regions/{region_id}`
- 筛选：
  - 设置主时间轴：`PUT /api/v1/filters/main-timeline?start=...&end=...`
  - 设置副时间轴：`PUT /api/v1/filters/secondary-timeline?start=...&end=...`
  - 过滤项目（主时间轴交集）：`GET /api/v1/filters/projects`
  - 过滤员工（副时间轴可用）：`GET /api/v1/filters/employees?region=华南区域`

3.1后端架构：Fastapi+SQLite（开发） PostgreSQL（生产）
3.1.1主要模型：
员工模型{
    id: Integer,
    name: String,
    gender：string,
    email: String,
    phone: String,
    position: String,
    department: String,
    region: String
}
项目模型{
    id: Integer,
    name: String,
    value: float,
    region: String,
    start_time: DateTime,
    end_time: DateTime
}
区域模型{
    id: Integer,
    name: String,
    location: String,
}
员工分配模型{
    employee_id: Integer,
    project_id: Integer,
    start_time: DateTime,
    end_time: DateTime
}

3.1.1.1属性阐述
value: float---记录项目的价值，单位为万元

region: String---记录项目所在的区域，可选值为西南区域、华中区域、华南区域、华东区域

start_time: DateTime---记录项目的开始时间

end_time: DateTime---记录项目的结束时间

员工的时间分配信息通过员工分配模型来表示，一个员工可以有多个时间分配记录，每个记录包含员工ID、项目ID以及在该项目中的时间范围。

3.2 全局变量
3.2.1主时间轴-main_timeline 类型为NewTimeDelta的实例
作用：根据主时间轴筛选项目，只显示与主时间轴范围交集非空的项目

3.2.2副时间轴-secondary_timeline 类型为NewTimeDelta的实例
作用：根据副时间轴筛选员工，只显与副时间轴交集不等于副时间轴的员工

3.3主时间轴于副时间轴的关系：副时间轴必须在主时间轴范围内，并且各个副时间轴之间交集为空

4.4自定义类
NewTimeDelta---使用dataclass实现，包含start_time和end_time属性，记录时间间隔的开始和结束时间。
class NewTimeDelta:
    start_time: datetime
    end_time: datetime

    @property
    def seconds(self) -> float:
        return (self.end_time - self.start_time).total_seconds()

    def get_total_times(self, unit: str = "days") -> float:
        total_seconds = self.seconds
        if unit == "days":
            return total_seconds / 86400
        elif unit == "hours":
            return total_seconds / 3600
        elif unit == "minutes":
            return total_seconds / 60
        else:
            return total_seconds

4.1 业务函数

4.1.1时间交集计算函数
作用：计算两个时间间隔的交集，返回交集或None。
def Time_Intersection(time1, time2):
    max_start = max(time1.start_time, time2.start_time)
    min_end = min(time1.end_time, time2.end_time)
    if max_start >= min_end:
        return None
    return NewTimeDelta(start_time=max_start, end_time=min_end)

4.1.2项目过滤函数：Pj_Filter()
作用：根据主时间轴和项目时间轴筛选项目，只显示与主时间轴范围交集非空的项目。
if Time_Intersection(main_timeline,project_timeline)!=None:
    at_time=True
else:
    at_time=False
    
4.1.3员工过滤函数：Em_Filter()
作用：根据副时间轴和员工时间轴筛选员工，只显示在副时间轴内仍有可用时段的员工。
判断逻辑：计算员工所有指派与副时间轴的交集总时长，若小于副时间轴时长，则视为可用。
def Em_Filter(assign_timeline, secondary_timeline):
    intersections = [Time_Intersection(r, secondary_timeline) for r in assign_timeline]
    occupied = sum_Intersection_timedeltas(intersections)
    required = secondary_timeline.end_time - secondary_timeline.start_time
    return occupied < required



        
   

